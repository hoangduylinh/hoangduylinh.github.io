<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calculator</title>
    <link rel="stylesheet" href="calculator.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jQuery/2.1.3/jQuery.min.js"></script>
    
</head>

<body>

    <div class="calculator">
        <div class="header">
            <div class="theme">
                <span onclick="theme()" class="theme">Theme</span>
            </div>
            <form name="form">
                <input id="fill_in" name="textview" type="text">
            </form>
        </div>
        <div class="on-screen">
            <table>
                <tr>
                    <td><input class="button" type="button" value="C" onclick="clean()"></td>
                    <td><input class="button" type="button" value="del" onclick="del()"></td>
                    <td><input class="button divide" type="button" value=":" onclick="insertNum(':')"></td>
                    <td><input class="button multi" type="button" value="x"  onclick="phepNhan('x')"></td>
    
                </tr>
                <tr>
                    <td><input class="button" type="button" value="!" onclick="giaiThua('!')"></td>
                    <td><input class="button" type="button" value="sqrt" onclick="canBac2()"></td>
                    <td><input class="button" type="button" value="^" onclick="binhPhuong()"></td>
                    <td><input class="button" type="button" value="+" onclick="insertNum('+')"></td>
                </tr>
    
                <tr>
                    <td><input class="button number" type="button" value="1" onclick="insertNum(1)"></td>
                    <td><input class="button number" type="button" value="2" onclick="insertNum(2)"></td>
                    <td><input class="button number" type="button" value="3" onclick="insertNum(3)"></td>
                    <td><input class="button number" type="button" value="-" onclick="insertNum('-')"></td>
    
                </tr>
                <tr>
                    <td><input class="button number" type="button" value="4" onclick="insertNum(4)"></td>
                    <td><input class="button number" type="button" value="5" onclick="insertNum(5)"></td>
                    <td><input class="button number" type="button" value="6" onclick="insertNum(6)"></td>
                    <td><input class="button" type="button" value="%" onclick="insertNum('%')"></td>
    
                </tr>
                <tr>
                    <td><input class="button number" type="button" value="7" onclick="insertNum(7)"></td>
                    <td><input class="button number" type="button" value="8" onclick="insertNum(8)"></td>
                    <td><input class="button number" type="button" value="9" onclick="insertNum(9)"></td>
                    <td rowspan="2"><input class="button" style="height: 120px;" type="button" value="=" onclick="equal()">
                    </td>
                </tr>
                <tr>
                    <div class="zero"><td colspan="2"><input class="button" style="width: 120px;" type="button" value="0"
                        onclick="insertNum(0)"></td></div>
                    <td><input class="button" type="button" value="." onclick="insertNum('.')"></td>
    
                </tr>
            </table>
        </div>
    </div>

    <script>
        //Khi mới load trang xong, vì chưa có số nào trên màn hình nên sẽ không ấn được dấu "x", "÷", "="
        $(function(){
            $('table input.multi').attr('disabled',true);
            $('table input.divide').attr('disabled',true);
            $('table input.equal').attr('disabled',true);
        });

        //Thực hiện các hành động bên trong khi ấn vào các nút số, phép tính, dấu '.'
        $('table input.number, table input.option, table input.dot').on('click', function(){
            char = $(this).html(); //Lấy giá trị vừa click
            result = $('.on-screen .header').html(); //Lấy chuỗi giá trị trong ô phép tính
            $('.on-screen .header').html(result + char); //Thêm giá trị vừa click vào ô giá trị hiện tại
            $('table input.equal').removeAttr('disabled'); //bỏ vô hiệu hóa dấu =
            $('table input.option').removeAttr('disabled'); //bỏ vô hiệu hóa phép toán
        });

        //Khi click vào dấu x thì sẽ không click tiếp dấu x nữa, cũng ko click đc dấu "÷"
        $('table button.multi').on('click', function(){
            $('table button.multi').attr('disabled',true);
            $('table button.divide').attr('disabled',true);
        });

        //Tương tự bên trên
        $('table button.divide').on('click',function(){
            $('table button.divide').attr('disabled',true);
            $('table button.multi').attr('disabled',true);
        });

        //Khi ấn nút AC thì ô giá trị sẽ hiện rỗng
        $('table button.clean').on('click', function(){
            $('#calculator #display').html("");
        });

        //Khi ấn nút xóa, sẽ xóa từng phần tử 1
        $('table button.undo').on('click', function(){
            result = $('#calculator #display').html();
            $('#calculator #display').html(result.substring(0, result.length - 1));
        });

        //Thực hiện phép tính %
        $('table button.percent').on('click', function(){
            result = $('#calculator #display').html();
            $('#calculator #display').html(result / 100);
        });

        //Thực hiện phép tính mũ 2
        $('table button.square').on('click', function(){
            result = $('#calculator #display').html();
            if(result == ''){
                $('#calculator #display').html(0);
            }else{
               $('#calculator #display').html(result * result); 
            }
        });

        //Thực hiện phép tính căn bậc 2
        $('table button.sqrt').on('click',function(){
            result = $('#calculator #display').html();
            $('#calculator #display').html(Math.sqrt(result)); 
        });


        //Thực hiện phép tính giai thừa
        $('table button.giaithua').on('click',function(){
            result = $('#calculator #display').html();
            if(result < 0){
                $('#calculator #display').html('Error!');
            }else if(result == 0){
                $('#calculator #display').html(1);
            }else{
                let res = 1;
                for (let i = 1; i <= result; i++) {
                    res = res * i;
                }
                $('#calculator #display').html(res);
            }
        })

        //Thực thi kết quả trong ô giá trị, thay thế x = *, ÷ = /
        $('table button.equal').on('click', function(){
            result = $('#calculator #display').html();
            result = result.replaceAll("×" , "*");
            result = result.replaceAll("÷" , "/");
            $('#calculator #display').html(eval(result));
        });
        // theme
        function theme() {
            document.querySelector(".calculator").classList.toggle("change-color");
}


    </script>
</body>

</html>